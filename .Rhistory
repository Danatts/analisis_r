knitr::opts_chunk$set(echo = TRUE)
df |>
ggplot(aes(tipo_vehiculo, costo_total, fill = tipo_vehiculo)) +
geom_boxplot(outlier.alpha = 0.2) +
scale_y_log10(labels = label_number(scale_cut = cut_si(" "))) +
facet_wrap(~ anio) +
labs(title = "Severidad por tipo de vehículo y año", x = NULL, y = "Costo (log10)")
# Actividad 1
## 1) Paquetes y datos
### 1.1) Carga de paquetes
```{r echo=TRUE, results='hide', message=FALSE, warning=FALSE}
### 1.2) Generación de una base sintética
Simulamos **frecuencia** y **severidad** por asegurado y año con variables
```{r}
set.seed(2025)
n <- 2500
df <- tibble(
anio = sample(2021:2024, n, replace = TRUE, prob = c(0.2, 0.3, 0.3, 0.2)),
region = sample(c("Andina","Caribe","Pacífico","Orinoquía"), n,
replace = TRUE, prob = c(0.5,0.2,0.25,0.05)),
tipo_vehiculo = sample(c("Sedán","SUV","Moto","Pickup"), n,
replace = TRUE, prob = c(0.4,0.3,0.2,0.1)),
edad = pmin(pmax(round(rnorm(n, 42, 12)), 18), 80),
genero = sample(c("F","M"), n, replace = TRUE, prob = c(0.45, 0.55)),
# Exposición anual (años asegurado): entre 0.2 y 1
expo = round(runif(n, 0.2, 1.0), 2)
) |>
mutate(
# Frecuencia (Poisson) condicionada por segmentos
lambda_base = 0.25 +
0.05*(tipo_vehiculo=="Moto") +
0.07*(tipo_vehiculo=="Pickup") +
0.03*(region=="Caribe") +
0.04*(edad < 25) +
0.02*(edad > 70),
reclamos = rpois(n, lambda = pmax(lambda_base * expo, 0.01)),
# Severidad lognormal dependiente del tipo de vehículo
mu_sev = 8.0 + 0.25*(tipo_vehiculo %in% c("SUV","Pickup")),
sigma_sev = 0.6 + 0.05*(region=="Pacífico"),
costo_prom = rlnorm(n, meanlog = mu_sev, sdlog = sigma_sev),
# Costo total (severidad por número de reclamos)
costo_total = round(costo_prom * pmax(reclamos, 1) * rlnorm(n, 0, 0.2), 0),
prima = round( # prima simple basada en frecuencia esperada y severidad típica
(lambda_base * exp(mu_sev + (sigma_sev^2)/2)) * 1.15 * expo, 0
)
) |>
mutate(
# Tasa de siniestralidad (loss ratio) simple
loss_ratio = costo_total / pmax(prima, 1)
)
glimpse(df)
library(tidyverse)
### 1.2) Generación de una base sintética
Simulamos **frecuencia** y **severidad** por asegurado y año con variables
```{r}
set.seed(2025)
n <- 2500
df <- tibble(
anio = sample(2021:2024, n, replace = TRUE, prob = c(0.2, 0.3, 0.3, 0.2)),
region = sample(c("Andina","Caribe","Pacífico","Orinoquía"), n,
replace = TRUE, prob = c(0.5,0.2,0.25,0.05)),
tipo_vehiculo = sample(c("Sedán","SUV","Moto","Pickup"), n,
replace = TRUE, prob = c(0.4,0.3,0.2,0.1)),
edad = pmin(pmax(round(rnorm(n, 42, 12)), 18), 80),
genero = sample(c("F","M"), n, replace = TRUE, prob = c(0.45, 0.55)),
# Exposición anual (años asegurado): entre 0.2 y 1
expo = round(runif(n, 0.2, 1.0), 2)
) |>
mutate(
# Frecuencia (Poisson) condicionada por segmentos
lambda_base = 0.25 +
0.05*(tipo_vehiculo=="Moto") +
0.07*(tipo_vehiculo=="Pickup") +
0.03*(region=="Caribe") +
0.04*(edad < 25) +
0.02*(edad > 70),
reclamos = rpois(n, lambda = pmax(lambda_base * expo, 0.01)),
# Severidad lognormal dependiente del tipo de vehículo
mu_sev = 8.0 + 0.25*(tipo_vehiculo %in% c("SUV","Pickup")),
sigma_sev = 0.6 + 0.05*(region=="Pacífico"),
costo_prom = rlnorm(n, meanlog = mu_sev, sdlog = sigma_sev),
# Costo total (severidad por número de reclamos)
costo_total = round(costo_prom * pmax(reclamos, 1) * rlnorm(n, 0, 0.2), 0),
prima = round( # prima simple basada en frecuencia esperada y severidad típica
(lambda_base * exp(mu_sev + (sigma_sev^2)/2)) * 1.15 * expo, 0
)
) |>
mutate(
# Tasa de siniestralidad (loss ratio) simple
loss_ratio = costo_total / pmax(prima, 1)
)
glimpse(df)
df |>
ggplot(aes(costo_total)) +
geom_histogram(bins = 40, color = "white") +
scale_x_log10(labels = label_number(scale_cut = cut_si(" "))) +
labs(title = "Distribución de costos (log10)",
x = "Costo total (log10)",
y = "Frecuencia")
df |>
ggplot(aes(costo_total, fill = tipo_vehiculo)) +
geom_density(alpha = 0.3) +
scale_x_log10(labels = scales::label_number(scale_cut = scales::cut_si(" "))) +
labs(title = "Densidad de costos por tipo de vehículo",
x = "Costo total (log10)", y = "Densidad")
df |>
ggplot(aes(costo_total)) +
geom_histogram(bins = 40, color = "white") +
scale_x_log10(labels = label_number(scale_cut = cut_si(" "))) +
labs(title = "Distribución de costos (log10)",
x = "Costo total (log10)",
y = "Frecuencia")
df |>
ggplot(aes(tipo_vehiculo, costo_total, fill = tipo_vehiculo)) +
geom_boxplot(outlier.alpha = 0.2) +
scale_y_log10(labels = scales::label_number(scale_cut = scales::cut_si(" "))) +
labs(title = "Severidad por tipo de vehículo",
y = "Costo total (log10)", x = NULL)
set.seed(1)
df |>
sample_n(800) |>
ggplot(aes(tipo_vehiculo, costo_total, fill = tipo_vehiculo)) +
geom_violin(trim = FALSE, alpha = 0.2) +
geom_jitter(width = 0.1, alpha = 0.25) +
scale_y_log10(labels = scales::label_number(scale_cut = scales::cut_si(" "))) +
labs(title = "Distribución intra-segmento (violín + puntos)",
y = "Costo total (log10)")
df |>
ggplot(aes(tipo_vehiculo, costo_total, fill = tipo_vehiculo)) +
geom_boxplot(outlier.alpha = 0.2) +
scale_y_log10(labels = label_number(scale_cut = cut_si(" "))) +
facet_wrap(~ anio) +
labs(title = "Severidad por tipo de vehículo y año", x = NULL, y = "Costo (log10)")
library(scales)
df |>
ggplot(aes(tipo_vehiculo, costo_total, fill = tipo_vehiculo)) +
geom_boxplot(outlier.alpha = 0.2) +
scale_y_log10(labels = label_number(scale_cut = cut_si(" "))) +
facet_wrap(~ anio) +
labs(title = "Severidad por tipo de vehículo y año", x = NULL, y = "Costo (log10)")
df_hm <- df |>
mutate(edad_grupo = cut(edad, breaks = c(18,25,35,45,55,65,80),
labels = c("18-25","26-35","36-45","46-55","56-65","66-80"),
include.lowest = TRUE)) |>
group_by(edad_grupo, tipo_vehiculo) |>
summarise(mediana = median(costo_total), .groups = "drop")
df_hm |>
ggplot(aes(tipo_vehiculo, edad_grupo, fill = mediana)) +
geom_tile(color = "white") +
scale_fill_viridis_c(labels = label_number(scale_cut = cut_si(" "))) +
labs(title = "Mapa de severidad mediana", x = "Tipo de vehículo", y = "Grupo de edad")
df |>
arrange(desc(costo_total)) |>
mutate(acum = cumsum(costo_total) / sum(costo_total),
idx = row_number()) |>
ggplot(aes(idx, acum)) +
geom_line(color="steelblue") +
geom_hline(yintercept = 0.8, linetype = "dashed") +
labs(title = "Curva de Pareto del costo", x = "Pólizas ordenadas", y = "Acumulado")
